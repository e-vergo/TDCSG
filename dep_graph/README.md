# TDCSG Dependency Graph Visualization

Interactive browser-based visualization of the TDCSG Lean 4 formal verification project's dependency graph.

## Files

- **`index.html`** - Main page structure
- **`graph.js`** - Cytoscape.js configuration and interactivity logic
- **`styles.css`** - Visual styling (colorful gradient theme)
- **`graph.json`** - Main dependency graph data (generated by extraction agent)
- **`positions.json`** - Saved node positions (optional, generated by user)
- **`test_graph.json`** - Small test dataset for development

## Usage

### View the Graph

**Recommended method (avoids CORS issues):**
```bash
cd dep_graph
./serve.sh
# Then open http://localhost:8000/index.html in your browser
```

**Alternative method:**
1. Open `index.html` directly in a modern browser (Chrome, Firefox, Safari)
2. If you encounter CORS errors due to `file://` protocol, select `graph.json` from the file picker
3. To test with sample data, open `index.html?test` (loads `test_graph.json`)

### Interactive Features

**Click a node**: Opens info panel showing:
- Full declaration name
- Type (theorem/def/lemma/inductive)
- Documentation (truncated to 200 chars)
- Direct dependencies (clickable list - jumps to that node)
- GitHub source link (opens in new tab)
- Paper references (if any)

**Hover a node**: Shows tooltip with short name

**Drag a node**: Freely reposition nodes

**Zoom**: Mouse scroll to zoom in/out

**Pan**: Click-drag background to pan

**Search**: Type in search box to filter/highlight nodes by name

**Save Layout**: Downloads current node positions to `positions.json` (manual: move downloaded file to `dep_graph/positions.json` for persistence)

**Reset View**: Returns to fit-all-nodes view

### Color Scheme

- **Theorems**: Coral red (#FF6B6B) - ellipse
- **Definitions**: Turquoise (#4ECDC4) - rectangle
- **Lemmas**: Light coral (#FFA07A) - ellipse
- **Inductives**: Yellow (#FFD93D) - diamond
- **Main theorems**: Gold (#FFD93D) with red border (#FF6B6B) - larger, prominent

**Background**: Purple gradient

**Edges**: Soft gray with bezier curves and small arrows

### Layout Algorithm

- **Force-directed**: Cose-Bilkent layout (optimized for large graphs)
- **Position persistence**: If `positions.json` exists, loads saved positions; otherwise runs force-directed layout
- **Manual adjustment**: Drag nodes and save layout to preserve custom arrangements

## JSON Schema

The visualization consumes `graph.json` with this schema:

```json
{
  "nodes": [
    {
      "id": "TDCSG.Namespace.DeclarationName",
      "label": "DeclarationName",
      "type": "theorem|def|lemma|inductive",
      "namespace": ["TDCSG", "Namespace"],
      "file": "TDCSG/File.lean",
      "line": 123,
      "docstring": "Documentation text...",
      "paperRefs": ["Theorem 3.2"],
      "isMainTheorem": true|false
    }
  ],
  "edges": [
    {
      "source": "TDCSG.Namespace.Declaration1",
      "target": "TDCSG.Namespace.Declaration2"
    }
  ]
}
```

## Technology Stack

- **Cytoscape.js 3.28.1** - Graph visualization library
- **Cose-Bilkent 4.1.0** - Force-directed layout algorithm
- **Vanilla JavaScript** - No build step required
- **Modern CSS** - Gradients, shadows, playful colors

## Browser Compatibility

Tested on:
- Chrome 90+
- Firefox 88+
- Safari 14+

Requires modern browser with ES6 support and no CORS restrictions for local file access.

## Development

To test with sample data:
1. Open `index.html?test` to load `test_graph.json` (5 nodes, 5 edges)
2. Make changes to HTML/CSS/JS
3. Refresh browser to see updates
4. No build step required

## Troubleshooting

**"Error Loading Graph" message**: Ensure `graph.json` exists and is valid JSON

**Nodes don't appear**: Check browser console for errors; verify JSON schema matches expected format

**Layout looks wrong**: Delete `positions.json` to regenerate force-directed layout

**GitHub links don't work**: Verify repository URL and file paths in `graph.json`
