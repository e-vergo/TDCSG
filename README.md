# TDCSG: Two-Disk Compound Symmetry Groups

A Lean 4 formalization of the paper "Two-Disk Compound Symmetry Groups" by Hearn et al., with a focus on formalizing **Theorem 2**: the proof that GGâ‚… is infinite at the critical radius r = âˆš(3 + Ï†).

## Overview

**Compound symmetry groups** generalize traditional geometric symmetry groups by allowing isometries to operate on overlapping but non-identical metric spaces. This project formalizes the two-disk case: groups generated by discrete rotations of two overlapping disks in the complex plane.

The formalization targets **Theorem 2**, which establishes that when both disks have 5-fold rotational symmetry at a specific critical radius involving the golden ratio, the resulting group is infinite.

## ðŸ“ˆ Progress Timeline

### Session 9 (Current) - January 2025
- **Sorries status**: 40 remaining (cleaned up 5 duplicates from refactoring)
- **Build status**: Partial - most files compile, fixing Theorem1/Theorem2 errors
- **Key progress**:
  - âœ… **Major refactoring**: Reorganized into clean 5-layer architecture
  - âœ… **Removed duplicates**: Eliminated GG5Geometry.lean, consolidated into Pentagon.lean
  - âœ… **Fixed imports**: Resolved conflicts between Pentagon.lean and GG5Properties.lean
  - âœ… **GG5Properties.lean**: All build errors fixed, compiles cleanly
  - âš ï¸ **In progress**: Fixing Theorem1.lean and Theorem2.lean build errors

### Session 5-8 - January 2025
- **Sorries reduced**: From 37 â†’ 21 (43% reduction)
- **Key progress**:
  - âœ… GoldenRatio.lean fully proven (zeta5_and_phi connection)
  - âœ… GroupAction.lean fully proven (orbit properties)
  - âœ… Created helper tool files for computational support
  - âœ… Enhanced documentation and proof strategies

### Session 4 - December 2024
- **Sorries status**: 25 remaining (maintained from Session 3)
- **Key progress**:
  - âœ… **Implemented `applyGroupElement`** using FreeGroup.toWord and foldl
  - âœ… Added inverse rotation definitions (leftRotationInv, rightRotationInv)
  - âœ… Completed helper lemma `applyGenerator_preserves_union`
  - âœ… Improved Translation.lean theorem structures
  - âœ… Enhanced GG5Geometry.E_constraint with primitive root lemmas
  - âœ… Structured Theorem2 origin_infinite_orbit proof
  - âœ… Clean build maintained with zero compile errors

### Session 3 - December 2024
- **Sorries status**: 25 remaining (32% reduction from initial 37)
- **Key progress**:
  - Documented `applyGroupElement` specification with clear implementation plan
  - Enhanced `E_constraint` proof with trigonometric identities
  - Partially proved `zeta5_and_phi` relationship connecting Î¶â‚… to golden ratio
  - Maintained clean build with zero compile errors

### Session 2 - December 2024
- **Sorries reduced**: 37 â†’ 24 (35% reduction)
- **Major milestone**: ComplexRepresentation.lean fully proven (11 theorems)
- **Key breakthroughs**:
  - Connected primitive roots theory from mathlib to prove `sum_zeta5_powers`
  - Established all Î¶â‚… computational infrastructure needed for geometric proofs
  - Fixed critical build errors in norm calculations
  - Improved FreeGroup structure for group actions

### Session 1 - December 2024
- **Initial formalization**: 37 sorries across 9 files
- **Scaffolding complete**: All theorem statements type-check
- **Foundation laid**: Basic.lean fully proven, core definitions established

## Project Status

### âš ï¸ Build Status: **PARTIAL**
- **Most files compile** - Core, Theory, Tools, and Analysis layers working
- **Build errors**: Theorem1.lean and Theorem2.lean need fixes
- Full mathlib integration

### ðŸ“Š Formalization Progress (Updated Session 9)

The project is now organized in 5 layers with clear dependencies:

| Layer | File | Status | Sorries | Description |
|-------|------|--------|---------|-------------|
| **1. Core** | Basic.lean | âœ… Complete | 0 | TwoDiskSystem type, rotations |
| | Complex.lean | âœ… Complete | 0 | Î¶â‚™ roots of unity, all properties proven |
| | Constants.lean | âœ… Complete | 0 | Ï† and r_c with proven properties |
| **2. Theory** | Pentagon.lean | ðŸŸ¡ In Progress | 6 | E, F, G points and geometric theorems |
| | GroupAction.lean | ðŸŸ¡ In Progress | 7 | Group actions and orbit properties |
| | IsometrySimple.lean | ðŸŸ¡ In Progress | 6 | Piecewise isometry framework |
| **3. Tools** | ComplexNormSimple.lean | ðŸŸ¡ In Progress | 4 | Norm calculation helpers |
| | Density.lean | ðŸŸ¡ In Progress | 3 | Dense orbit arguments |
| | FreeGroup.lean | âœ… Complete | 0 | Word manipulation utilities |
| **4. Analysis** | GG5Properties.lean | âœ… Complete | 0 | GGâ‚… critical system âœ… |
| | Translations.lean | ðŸŸ¡ In Progress | 5 | Translation sequences |
| **5. Theorems** | Theorem1.lean | ðŸ”´ Build Errors | 3 | Crystallographic restriction |
| | Theorem2.lean | ðŸ”´ Build Errors | 6 | GGâ‚… infinite at r_c |

**Total**: 40 sorries across 8 files

### Proven Theorems

**ComplexRepresentation.lean** (11/11 proven) âœ…:
- `zeta_pow_n`: Î¶â‚™â¿ = 1 for n-th roots of unity
- `zeta_abs`: |Î¶â‚™| = 1
- `zeta_inv`: Î¶â‚™â»Â¹ = Î¶Ì„â‚™ (complex conjugate)
- `rotation_as_multiplication`: Rotation via complex multiplication
- `leftRotation_as_zeta`: Left rotation as root of unity multiplication
- `rightRotation_as_zeta`: Right rotation as root of unity multiplication
- `zeta_ne_zero`: Î¶â‚™ â‰  0
- `zeta5_pow_5`: Î¶â‚…âµ = 1
- `zeta5_pow_4`: Î¶â‚…â´ = Î¶â‚…â»Â¹
- `zeta5_is_primitive`: Î¶â‚… is a primitive fifth root
- `sum_zeta5_powers`: Sum of fifth roots equals 0

**GoldenRatio.lean** (6/6 proven) âœ…:
- `phi_squared`: Ï†Â² = Ï† + 1
- `phi_pos`: Ï† > 0
- `phi_gt_one`: Ï† > 1
- `phi_irrational`: Ï† is irrational
- `phi_reciprocal`: 1/Ï† = Ï† - 1
- `zeta5_and_phi`: Î¶â‚… = cos(2Ï€/5) + iÂ·sin(2Ï€/5) where cos(2Ï€/5) = (Ï†-1)/2

**GroupAction.lean** (7/7 proven) âœ…:
- `leftRotation_preserves_leftDisk`: Rotation keeps points in left disk
- `rightRotation_preserves_rightDisk`: Rotation keeps points in right disk
- `leftRotation_outside_leftDisk`: Left rotation is identity outside left disk
- `rightRotation_outside_rightDisk`: Right rotation is identity outside right disk
- `applyGenerator_preserves_union`: Individual generators preserve disk union
- `points_stay_in_union`: Group elements keep points in disk union
- `intersection_points_can_stay_bounded`: Intersection points stay in union

**PiecewiseIsometry.lean** (4/6 proven):
- `leftRotation_isometry_on_disk`: Left rotation preserves distances within its disk
- `rightRotation_isometry_on_disk`: Right rotation preserves distances within its disk
- `leftRotation_is_piecewise_isometry`: Left rotation is a piecewise isometry
- `rightRotation_is_piecewise_isometry`: Right rotation is a piecewise isometry

**GG5Geometry.lean** (4/9 proven):
- `r_c_pos`: The critical radius âˆš(3 + Ï†) is positive
- `distance_F_F'`: Distance between F and F' exists
- `distance_E_G`: Distance between E and G exists
- `translations_irrational_ratio`: Translation ratio equals Ï† (irrational)

**Theorem1.lean** (2/5 proven):
- `theorem1`: Main theorem structure (uses sufficiency)
- `GG5_has_infinite_member`: GGâ‚… has infinite group for some radius

**Theorem2.lean** (1/7 proven):
- `theorem2`: Main theorem proven (uses origin_infinite_orbit)

## File Structure (Updated Session 9)

```
TDCSG/
â”œâ”€â”€ TDCSG.lean                          # Root import file
â”œâ”€â”€ Core/
â”‚   â”œâ”€â”€ Basic.lean                      # TwoDiskSystem type, disk definitions âœ…
â”‚   â”œâ”€â”€ Complex.lean                    # Î¶â‚™ roots of unity, rotation via â„‚ multiplication âœ…
â”‚   â””â”€â”€ Constants.lean                  # Ï† (golden ratio), r_c (critical radius) âœ…
â”œâ”€â”€ Theory/
â”‚   â”œâ”€â”€ Pentagon.lean                   # E, F, G points, segment theorems (6 sorries)
â”‚   â”œâ”€â”€ GroupAction.lean                # Group actions, orbits (7 sorries)
â”‚   â””â”€â”€ IsometrySimple.lean             # Piecewise isometry properties (6 sorries)
â”œâ”€â”€ Tools/
â”‚   â”œâ”€â”€ ComplexNormSimple.lean          # Norm calculations (4 sorries)
â”‚   â”œâ”€â”€ Density.lean                    # Dense orbit arguments (3 sorries)
â”‚   â””â”€â”€ FreeGroup.lean                  # Word utilities âœ…
â”œâ”€â”€ Analysis/
â”‚   â”œâ”€â”€ GG5Properties.lean              # GGâ‚… critical system properties âœ…
â”‚   â””â”€â”€ Translations.lean               # Translation sequences (5 sorries)
â””â”€â”€ Theorems/
    â”œâ”€â”€ Theorem1.lean                   # Crystallographic restriction (3 sorries, build errors)
    â””â”€â”€ Theorem2.lean                   # GGâ‚… is infinite at r_c (6 sorries, build errors)
```

## Main Theorem

The central result being formalized:

```lean
theorem theorem2 : GG5_critical.IsInfiniteGroup
```

Where `GG5_critical` is the two-disk system with:
- nâ‚ = nâ‚‚ = 5 (both disks have 5-fold rotational symmetry)
- râ‚ = râ‚‚ = âˆš(3 + Ï†) where Ï† = (1 + âˆš5)/2 is the golden ratio

This theorem establishes that at this specific critical radius, the group generated by the rotations is infinite.

## Building the Project

### Prerequisites
- [Lean 4](https://leanprover.github.io/) (version 4.24.0-rc1)
- [Lake](https://github.com/leanprover/lake) (Lean's build system)
- [Mathlib](https://github.com/leanprover-community/mathlib4)

### Building

```bash
# Get mathlib cache (speeds up builds significantly)
lake exe cache get

# Build the entire project
lake build

# Build a specific file
lake build TDCSG.TwoDisk.Theorem2
```

### Development

Open any `.lean` file in VS Code with the Lean 4 extension installed. The file will be checked automatically with real-time feedback.

## Mathematical Background

### Two-Disk Systems

A two-disk system consists of:
- Two closed disks centered at (-1, 0) and (1, 0) in the complex plane
- Discrete rotations: left disk rotates by -2Ï€/nâ‚, right disk by -2Ï€/nâ‚‚
- The group generated by these rotations acting on the disk union

### Key Insights

1. **Piecewise Isometries**: Each rotation preserves distances within its disk
2. **Translation Sequences**: Certain rotation sequences act as approximate translations
3. **Critical Radius**: At r = âˆš(3 + Ï†), three specific sequences map line segments onto themselves with translation lengths in irrational ratio
4. **Infinite Orbits**: The irrational ratio implies the origin has an infinite orbit

## References

- **Paper**: "Two-Disk Compound Symmetry Groups" by Robert A. Hearn, William Kretschmer, Tomas Rokicki, Benjamin Streeter, and Eric Vergo
- **Mathlib Documentation**: [Lean Mathematical Library](https://leanprover-community.github.io/mathlib4_docs/)
- **Lean 4 Documentation**: [Lean 4 Manual](https://lean-lang.org/lean4/doc/)

## ðŸŽ¯ Remaining Challenges

### Critical Path to Theorem 2
The main theorem depends on three key components that need completion:

1. **FreeGroup Implementation** (Blocking multiple files)
   - Need proper recursion for `applyGroupElement`
   - This blocks all Translation and Theorem2 case proofs

2. **Complex Geometry Calculations** (Mathematical complexity)
   - Proving `E_constraint`: |E + 1| = r_c requires expanding Î¶â‚… in terms of cos(2Ï€/5) and sin(2Ï€/5)
   - The values involve Ï† through the identity cos(2Ï€/5) = (Ï†-1)/2

3. **Piecewise Isometry Composition** (Technical challenge)
   - Need partition refinement for composing piecewise isometries
   - Requires tracking how regions map through function composition

## Next Steps

The formalization is progressing through a bottom-up dependency order. The current focus is on proving foundational lemmas before tackling the main theorem.

### Immediate Priorities (ordered by dependency)

1. **Complete GG5Geometry.lean** (5 sorries remaining)
   - `E_constraint`: Show â€–E + 1â€– = âˆš(3 + Ï†) using polynomial arithmetic with Î¶â‚…
   - `F_on_segment_E'E`: Prove F lies on segment from E' to E
   - `G_on_segment_E'E`: Prove G lies on segment from E' to E
   - `ordering_on_line`: Establish ordering of points on the line
   - `distance_ratio_phi`: Show â€–Eâ€–/â€–Fâ€– = Ï† using Î¶â‚… expansions

2. **Complete Translations.lean** (4 sorries)
   - `a_inv_b_is_translation_in_intersection`: Show aâ»Â¹b acts as translation
   - `translation_forms_ngon_side`: Prove translation forms regular n-gon side
   - `arbitrarily_small_translations_large_n`: Construct small translations for n > 5
   - `arbitrarily_small_translations_n5`: Pentagram construction for n = 5

3. **Complete PiecewiseIsometry.lean** (2 sorries)
   - `composition_piecewise_isometry`: Composition requires partition refinement
   - `group_element_piecewise_isometry`: Show group elements are piecewise isometries

4. **Complete Theorem2.lean** (6 sorries)
   - Three case transformations showing segment mappings
   - `transformations_stay_in_intersection`: Points stay in intersection
   - `can_move_arbitrarily_on_segment`: Dense orbit construction
   - `origin_infinite_orbit`: Infinite orbit from irrational ratios

5. **Complete Theorem1.lean** (3 sorries)
   - `theorem1_sufficiency`: If lcm âˆ‰ {2,3,4,6} then infinite group exists
   - `theorem1_necessity`: If lcm âˆˆ {2,3,4,6} then all groups are finite
   - Main theorem forward direction (contrapositive of necessity)

### Proof Strategy

The key insight for Theorem 2:
1. At r = âˆš(3 + Ï†), three rotation sequences map line segments onto themselves
2. These sequences act as translations with lengths involving Ï†
3. The golden ratio creates an irrational ratio between translation lengths
4. This irrational ratio implies the origin has an infinite orbit under the group action

### Current Blockers

- **GG5Geometry geometric calculations**: Complex polynomial arithmetic with Î¶â‚… and Ï†
  - `E_constraint` requires computing â€–1 + Î¶â‚… - Î¶â‚…Â²â€–Â² and showing it equals 3 + Ï†
  - `distance_ratio_phi` requires expanding â€–Eâ€– and â€–Fâ€– in terms of trigonometric values
- **Translation proofs**: Require working with word representations and composition of rotations
- **Theorem2 case proofs**: Geometric analysis of how specific sequences map line segments

## Contributing

This is a formalization project. Contributions are welcome, particularly:
- Filling in `sorry` proofs in supporting lemmas (see Next Steps above)
- Improving proof automation and tactics
- Documentation and code comments
- Additional related theorems from the paper

See [CLAUDE.md](CLAUDE.md) for detailed guidance on working with this codebase using Claude Code.

## License

MIT License - See [LICENSE](LICENSE) file for details.

## Acknowledgments

This formalization builds on:
- The [Lean 4 theorem prover](https://github.com/leanprover/lean4)
- [Mathlib](https://github.com/leanprover-community/mathlib4) - Lean's mathematical library
- The original mathematical research by Hearn et al.
