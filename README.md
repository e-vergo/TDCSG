# TDCSG - Two-Disk Compound Symmetry Groups Formalization

Formal verification in Lean 4 of **Two-Disk Compound Symmetry Groups** from [arXiv:2302.12950v1](https://arxiv.org/abs/2302.12950).

**Primary Goal:** Formalize **Theorem 2** - the critical radius formula for GGâ‚… and the emergence of 1D interval exchange transformations from 2D piecewise isometry systems.

## Project Overview

### What are Two-Disk Compound Symmetry Groups?

Traditional symmetry groups are generated by isometries of a single metric space. **Compound symmetry groups** generalize this by allowing isometries to operate on overlapping but distinct metric subspaces.

The **two-disk system** GG_{nâ‚,nâ‚‚}(râ‚, râ‚‚) is defined by:
- Two overlapping closed disks in â„Â² centered at (-1, 0) and (1, 0)
- Radii râ‚ and râ‚‚
- Generator **a**: clockwise rotation by 2Ï€/nâ‚ on the left disk
- Generator **b**: clockwise rotation by 2Ï€/nâ‚‚ on the right disk
- Group elements are compositions of a and b, acting as piecewise isometries

### Critical Phenomenon

As disk radius increases, the groups undergo a phase transition from **finite to infinite** at a **critical radius**. At this exact transition point, remarkable fractal structures emerge.

**Our Target: Theorem 2** proves that for GGâ‚… (n=5 case):
- Critical radius r_c = âˆš(3 + Ï†) where Ï† is the golden ratio
- At r_c, a line segment E'E is piecewise mapped onto itself by three group elements
- **This forms a 3-interval exchange transformation embedded in the 2D system**
- The IET has irrational length ratios involving Ï† â†’ infinite orbit â†’ group is infinite

## Current Status (2025-10-17)

**Phase:** Setting up foundational scaffolding
**Build Status:** Foundation files compiling
**Target:** Theorem 2 fully formalized

### Existing Infrastructure (Completed)

**1D Piecewise Isometry Framework:**
- âœ… **TDCSG/Basic.lean** - Core `PiecewiseIsometry` structure
- âœ… **TDCSG/Properties.lean** - Partition properties, isometry lemmas
- âœ… **TDCSG/Composition.lean** - Composition of piecewise isometries
- âœ… **TDCSG/IntervalExchange.lean** - 1D IET infrastructure (critical for Theorem 2!)

Status: 6/8 original files complete (0 sorries), 2 files with research-level sorries (deferred)

### New Infrastructure (In Progress)

**2D Geometry Layer:**
- ğŸ”¨ **TDCSG/Planar/Rotations.lean** - Rotations about arbitrary points in â„Â²
- ğŸ”¨ **TDCSG/Planar/Disks.lean** - Disk geometry, overlap lemmas

**Compound Symmetry Layer:**
- ğŸ”¨ **TDCSG/CompoundSymmetry/TwoDisk.lean** - Core two-disk system structure
- ğŸ”¨ **TDCSG/CompoundSymmetry/Finiteness.lean** - Critical radius definition

**Theorem 2 Infrastructure:**
- ğŸ”¨ **TDCSG/CompoundSymmetry/GG5/Geometry.lean** - Points E, E', F, G; r_c definition
- ğŸ”¨ **TDCSG/CompoundSymmetry/GG5/SegmentMaps.lean** - Three group elements
- ğŸ”¨ **TDCSG/CompoundSymmetry/GG5/IET.lean** - IET emergence proof
- ğŸ”¨ **TDCSG/CompoundSymmetry/GG5/CriticalRadius.lean** - **Theorem 2 statement and proof**

Legend: âœ… Complete | ğŸ”¨ Scaffolding in progress

## Development Plan

### Phase 1: Foundations (Current)

**Goal:** Type-correct scaffolding with Mathlib integration

**Files to create:**
1. `Planar/Rotations.lean` - Build `rotateAround` using:
   - `Orientation.rotation` from Mathlib (linear rotation about origin)
   - `AffineIsometryEquiv` for translations
   - Composition: translate(-c) âˆ˜ rotate(Î¸) âˆ˜ translate(c)

2. `Planar/Disks.lean` - Use Mathlib's `Metric.closedBall`:
   - Overlap criteria, measurability, compactness
   - Intersection geometry

3. `CompoundSymmetry/TwoDisk.lean` - Core structure:
   - `TwoDiskSystem` with radii râ‚, râ‚‚ and rotation orders nâ‚, nâ‚‚
   - Generators genA, genB using `rotateAround`
   - Conversion to `PiecewiseIsometry` (from existing Basic.lean)

**Success criteria:**
- All files compile with `./check_lean.sh --errors-only`
- Type signatures correct
- Strategic `sorry` usage for proofs (filled in later phases)

### Phase 2: GGâ‚… Geometric Setup

**Files:**
4. `CompoundSymmetry/GG5/Geometry.lean` - Define:
   - Points E, E' using 5th roots of unity (Complex.exp)
   - Points F, G on segment E'E
   - r_crit = âˆš(3 + Ï†) using `Real.goldenRatio` from Mathlib
   - `GG5_critical : TwoDiskSystem` at r_crit

5. `CompoundSymmetry/GG5/SegmentMaps.lean` - Three group elements:
   - map1 = a^(-2)âˆ˜b^(-1)âˆ˜a^(-1)âˆ˜b^(-1): E'F â†’ GF
   - map2 = aâˆ˜bâˆ˜aâˆ˜bÂ²: FG â†’ FE
   - map3 = aâˆ˜bâˆ˜aâˆ˜b^(-1)âˆ˜a^(-1)âˆ˜b^(-1): GE â†’ E'G

**Success criteria:**
- Geometric points defined correctly
- Group element compositions type-check
- Segment bijection statements formulated

### Phase 3: IET Connection

**Files:**
6. `CompoundSymmetry/GG5/IET.lean` - **Key insight:**
   - Parametrize segment E'E as [0,1]
   - Compute interval lengths: involve golden ratio Ï†
   - Construct `GG5_induced_IET : IntervalExchangeTransformation 3`
   - Prove irrational ratios â†’ infinite orbit (using `Real.goldenRatio_irrational`)

**Success criteria:**
- Integration with existing `IntervalExchange.lean`
- IET structure proven to match segment dynamics
- Irrationality argument complete

### Phase 4: Theorem 2 Proof

**Files:**
7. `CompoundSymmetry/Finiteness.lean` - Define:
   - `CriticalRadius (n1 n2 : â„•) : â„` as infimum of infinite-orbit radii
   - Monotonicity: infinite at r â†’ infinite at r' > r

8. `CompoundSymmetry/GG5/CriticalRadius.lean` - **Main theorem:**
   ```lean
   theorem GG5_critical_radius :
     CriticalRadius 5 5 = Real.sqrt (3 + Real.goldenRatio)
   ```
   **Proof strategy:**
   - At r_crit: IET on segment â†’ infinite orbit (Phase 3)
   - Below r_crit: geometric argument â†’ all orbits finite
   - Therefore critical radius is exactly r_crit

**Success criteria:**
- Theorem 2 fully proven
- No sorries in proof chain
- Passes transparency check
- Mathlib-compliant code quality

### Out of Scope (Explicitly Deferred)

âŒ Fractal theory and Hausdorff dimension
âŒ General IFS (iterated function systems)
âŒ Multi-disk systems (3+ disks)
âŒ Complete proof of Theorem 1 (finiteness characterization)
âŒ Numerical verification for other n values
âŒ Ergodic theory connections
âŒ Measure preservation (unless needed for Theorem 2)

**Rationale:** Theorem 2 alone is a substantial formalization achievement. Extensions can build on this foundation later.

## Quick Start

### Prerequisites

```bash
# Lean 4 with lake
curl https://raw.githubusercontent.com/leanprover/elan/master/elan-init.sh -sSf | sh

# Clone repository
git clone https://github.com/yourusername/TDCSG.git
cd TDCSG

# Build project
lake build
```

### Development Workflow

**1. Make changes to `.lean` files**

**2. Fast error check** (use constantly):
```bash
./check_lean.sh --errors-only TDCSG/YourFile.lean
```

**3. Track proof progress:**
```bash
./check_lean.sh --sorries TDCSG/YourFile.lean
```

**4. Final verification:**
```bash
./check_lean.sh --transparency TDCSG/YourFile.lean
```

### Build Tool: `check_lean.sh`

**Why we built this:** Raw `lake build` output is 50,000-100,000 tokens per file. Our tool reduces this to 500-1,000 tokens (**99% reduction**) while providing complete diagnostics.

**Modes:**
| Mode | Command | Purpose |
|------|---------|---------|
| `--errors-only` | Fast compilation check | Use for every iteration |
| `--sorries` | Track incomplete proofs | See theorem names & locations |
| `--warnings-summary` | Categorized warnings | Code quality review |
| `--transparency` | **Proof evasion detection** | Enforce rigor standards |
| `--all <mode>` | Multi-file aggregation | Project-wide status |

**Full documentation:** [tools/CHECK_LEAN_TOOL.md](tools/CHECK_LEAN_TOOL.md)

**Key features:**
- Per-file filtering (no noise from dependencies)
- Never clips error messages
- Multi-file aggregation
- Exit codes for CI/CD integration
- **Transparency checking** - detects proof shortcuts and placeholders

## Rigor Standards

This project enforces **zero-tolerance** proof quality standards documented in [CLAUDE.md](CLAUDE.md).

### Anti-Placeholder Protocol

**Forbidden patterns** (detected by `./check_lean.sh --transparency`):

âŒ `theorem foo : True := trivial` - Provides zero mathematical content
âŒ `def IsPredicate (x : X) : Prop := True` - Trivializes dependent theorems
âŒ Using `axiom` to introduce custom axioms
âŒ Using `admitted` or `unsafe` keywords
âŒ Hidden sorries or `sorryAx` dependencies

**What constitutes completion:**
- âœ… Theorem statement is a meaningful mathematical proposition
- âœ… Proof derives the actual goal using legitimate tactics
- âœ… Zero custom axioms introduced
- âœ… `./check_lean.sh --errors-only` succeeds
- âœ… `./check_lean.sh --transparency` passes
- âœ… Would survive Mathlib reviewer scrutiny

**Philosophy:** Pre-existing technical debt is not an excuse to perpetuate it. Every new theorem must meet publication-grade standards.

### Validation Checklist

Before marking any `sorry` as complete:

- [ ] Theorem proves the actual proposition (not `True` or weakened version)
- [ ] Proof uses genuine tactics deriving the goal
- [ ] No axioms, no `admitted`, no `unsafe`
- [ ] `./check_lean.sh --errors-only TDCSG/File.lean` shows âœ“ success
- [ ] `./check_lean.sh --transparency TDCSG/File.lean` shows âœ“ PASS
- [ ] Code follows Mathlib style conventions

**If ANY criterion fails, the sorry is NOT complete.**

## Mathlib Integration

We build heavily on Mathlib's existing infrastructure:

### Ready to Use

**Planar geometry:**
- `Orientation.rotation` - Linear rotations about origin in â„Â²
- `AffineIsometryEquiv` - Affine isometric equivalences
- `IsometryEquiv` - General distance-preserving maps

**Metric spaces:**
- `Metric.closedBall` - Closed balls (our disks)
- `isCompact_closedBall`, `isClosed_closedBall` - Properties

**Group actions:**
- `MulAction` - Group action typeclass
- `MulAction.orbit` - Orbit of a point under group action
- `MulAction.stabilizer` - Subgroup fixing a point

**Special constants:**
- `Real.goldenRatio` - The golden ratio Ï† = (1 + âˆš5)/2
- `Real.goldenRatio_irrational` - Proof that Ï† is irrational

**Hausdorff dimension** (deferred):
- `dimH` - Hausdorff dimension of sets
- `hausdorffMeasure` - d-dimensional Hausdorff measure

### We Build

**Novel contributions:**
- `rotateAround` - Rotation about arbitrary point (straightforward Mathlib extension)
- `TwoDiskSystem` - Compound symmetry group structure
- Piecewise isometry framework (TDCSG/Basic.lean)
- IET infrastructure (TDCSG/IntervalExchange.lean) - **not in Mathlib**
- Connection between 2D piecewise isometries and 1D IETs

## Project Structure

```
TDCSG/
â”œâ”€â”€ check_lean.sh                    # Main build tool (use this!)
â”œâ”€â”€ tools/                           # Tool implementation
â”‚   â”œâ”€â”€ CHECK_LEAN_TOOL.md          # Comprehensive documentation
â”‚   â”œâ”€â”€ check_lean_errors_only.py
â”‚   â”œâ”€â”€ check_lean_sorries.py
â”‚   â”œâ”€â”€ check_lean_transparency.py  # Proof quality checker
â”‚   â””â”€â”€ ... (other modes)
â”œâ”€â”€ TDCSG/                           # Formalization
â”‚   â”œâ”€â”€ Basic.lean                  # âœ… Piecewise isometry framework
â”‚   â”œâ”€â”€ Properties.lean             # âœ… Supporting lemmas
â”‚   â”œâ”€â”€ Composition.lean            # âœ… Composition theory
â”‚   â”œâ”€â”€ IntervalExchange.lean       # âœ… IET infrastructure
â”‚   â”œâ”€â”€ Finite.lean                 # âœ… Finite partitions
â”‚   â”œâ”€â”€ MeasurePreserving.lean      # âœ… Measure theory
â”‚   â”œâ”€â”€ Examples.lean               # (deferred - 10 sorries)
â”‚   â”œâ”€â”€ Ergodic.lean                # (deferred - 4 sorries)
â”‚   â”œâ”€â”€ Planar/                     # ğŸ”¨ NEW: 2D geometry
â”‚   â”‚   â”œâ”€â”€ Rotations.lean          # Rotations about arbitrary points
â”‚   â”‚   â””â”€â”€ Disks.lean              # Disk geometry and overlaps
â”‚   â””â”€â”€ CompoundSymmetry/           # ğŸ”¨ NEW: Two-disk systems
â”‚       â”œâ”€â”€ TwoDisk.lean            # Core structure
â”‚       â”œâ”€â”€ Finiteness.lean         # Critical radius definition
â”‚       â””â”€â”€ GG5/                    # Theorem 2 proof
â”‚           â”œâ”€â”€ Geometry.lean       # Points E, E', F, G
â”‚           â”œâ”€â”€ SegmentMaps.lean    # Three group elements
â”‚           â”œâ”€â”€ IET.lean            # IET emergence
â”‚           â””â”€â”€ CriticalRadius.lean # Main theorem
â”œâ”€â”€ CLAUDE.md                        # Rigor standards and protocols
â””â”€â”€ README.md                        # This file
```

## Mathematical Background

### Piecewise Isometries

A **piecewise isometry** is a map f : Î± â†’ Î± on a metric space that:
- Partitions the space into measurable pieces
- Acts as an isometry on each piece
- May have discontinuities at partition boundaries

**Key properties:**
- Discontinuity set has measure zero
- Preserves distances within each piece
- Generalizes both IETs and compound symmetry groups

### Interval Exchange Transformations (IETs)

IETs are 1D piecewise isometries on [0,1) that:
- Partition [0,1) into finitely many intervals
- Rearrange intervals via permutation
- Translate each interval (preserving lengths)

**Significance for Theorem 2:** At the critical radius, the 2D two-disk system contains an embedded 3-interval IET on line segment E'E. This IET has irrational length ratios, causing infinite orbit and proving the group is infinite at that radius.

### The Critical Insight

**Traditional view:** Symmetry groups are generated by isometries of a single space.

**Compound symmetry:** Isometries operate on overlapping subspaces â†’ new phenomena:
- "Forbidden" symmetries locally (e.g., 5-fold rotation)
- Phase transitions from finite to infinite groups
- Fractal structures at critical points
- **Dimensional reduction:** 2D system â†’ 1D IET at critical point

## Key Theorems (Proven in Existing Files)

### Basic.lean
- `PiecewiseIsometry` structure definition
- `discontinuitySet_measurable` - discontinuity set is measurable
- `exists_mem_partition` - every point belongs to some partition piece

### Composition.lean
- `comp` - composition of piecewise isometries
- Partition refinement under composition

### IntervalExchange.lean âœ…
- `interval_injective` - interval function is injective (70-line proof)
- `intervals_cover` - intervals partition [0,1)
- `intervals_disjoint` - intervals are pairwise disjoint
- **This infrastructure is critical for Theorem 2!**

## References

### Primary Source

**Hearn, Kretschmer, Rokicki, Streeter, Vergo (2023)**
*Two-Disk Compound Symmetry Groups*
[arXiv:2302.12950v1](https://arxiv.org/abs/2302.12950) [math.MG]

**Key results we're formalizing:**
- **Theorem 1:** Characterization of which GG_{nâ‚,nâ‚‚} can be infinite (lcm not in {2,3,4,6})
- **Theorem 2:** GGâ‚… critical radius = âˆš(3 + Ï†) via IET emergence â† **Our target**
- Critical radii for n = 8, 10, 12 (geometric constructions)

### Related Literature

**Piecewise Isometries:**
- Goetz, *Piecewise isometriesâ€”an emerging area of dynamical systems* (2003)

**Interval Exchange Transformations:**
- Keane, "Interval Exchange Transformations" (1975)
- Masur, "Interval exchange transformations and measured foliations" (1982)
- Veech, "Gauss measures for transformations on the space of interval exchange maps" (1982)

**Mathlib Documentation:**
- [Mathlib4 docs](https://leanprover-community.github.io/mathlib4_docs/)
- Especially: Geometry.Euclidean, GroupTheory.GroupAction, Dynamics

## Contributing

### Development Standards

**Code quality:**
- Follow Mathlib style conventions
- Document all public definitions
- Explain proof strategies in comments
- Use `sorry` strategically (documented, temporary)

**Testing:**
- Every change: `./check_lean.sh --errors-only TDCSG/File.lean`
- Before commit: `./check_lean.sh --transparency TDCSG/File.lean`
- Project-wide: `./check_lean.sh --all errors-only TDCSG/`

**Git workflow:**
- Atomic commits (one logical change per commit)
- Descriptive commit messages
- Never commit files failing transparency check
- Clean `git status` (no scratch files)

### Agent/Automation Guidelines

**When using AI agents:**

1. **Spawn agents per file** for parallel scaffolding
2. **Always use `./check_lean.sh --errors-only`** for iteration
3. **Validate agent output** with transparency check before accepting
4. **Clean up scratch files** immediately after testing
5. **Trust but verify** - check agent claims mechanically

**Agent validation protocol:**
```bash
# Before accepting agent work:
./check_lean.sh --errors-only TDCSG/File.lean  # Must pass
./check_lean.sh --transparency TDCSG/File.lean # Must pass
git status | grep scratch                       # Must be empty
```

## Changelog

### 2025-10-17: Major Direction Shift - Two-Disk Systems

**New primary goal:** Formalize Theorem 2 from arXiv:2302.12950v1

**Infrastructure added:**
- Detailed implementation plan (this README)
- New file structure: Planar/ and CompoundSymmetry/ directories
- Scaffolding in progress for 8 new files

**Scope decisions:**
- **In scope:** Theorem 2 complete proof
- **Out of scope:** Fractals, general IFS, multi-disk systems, complete Theorem 1

**Rationale:** Theorem 2 is a substantial achievement connecting 2D piecewise isometries to 1D IETs via golden ratio geometry. It leverages our existing IET infrastructure and provides a solid foundation for future work.

### 2025-10-17: Transparency Checker Implementation

**New tooling:**
- `tools/check_lean_transparency.py` - Zero-tolerance proof quality checker
- `--transparency` mode enforces Anti-Placeholder Protocol

**Code remediation:**
- Fixed Composition.lean - replaced `trivial` with proper proof
- Removed 6 placeholder theorems from Examples.lean
- âœ… 8/8 files pass transparency check

### 2025-10-17: IET Infrastructure Completion

**Proofs completed:**
- `interval_injective` (IntervalExchange.lean:558-627) - 70-line rigorous proof
- Intervals partition [0,1) correctly
- Foundation ready for Theorem 2 IET emergence

## License

Apache 2.0 - See LICENSE file

## Contact

Eric Moffat - Project maintainer

---

**Status:** ğŸ”¨ **Scaffolding Phase** - Setting up type-correct foundations for Theorem 2 formalization
**Next milestone:** All Phase 1 files compile with proper Mathlib integration
**Target:** Theorem 2 fully proven with zero sorries, passing all transparency checks
