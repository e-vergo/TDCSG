# TDCSG - Two-Disk Compound Symmetry Groups

Formal verification in Lean 4 of the critical radius theorem for two-disk compound symmetry groups from [arXiv:2302.12950v1](https://arxiv.org/abs/2302.12950).

**Main Theorem (Theorem 2):** The compound symmetry group GG(5,5) at the critical radius r_crit = √(3 + φ) is infinite.

## Project Status

| Metric | Value |
|--------|-------|
| Build | ✅ Compiles (2404 jobs) |
| Sorries | 0 |
| Axioms | Standard only (propext, Quot.sound, Classical.choice, funext) |
| Kim Morrison Standard | ✅ All checks pass |

**Complete.** All proofs are fully formalized with no sorries or non-standard axioms.

## Main Theorem Statement

```lean
/-- **Theorem 2**: The compound symmetry group GG₅ at the critical radius is infinite.

    This is the precise statement from arXiv:2302.12950v1:
    The group generated by the two 5-fold rotation generators A and B,
    where each acts as the identity outside its disk, is an infinite group.

    Formally: `GG5_At_Critical_radius : Subgroup (Equiv.Perm ℂ)` has infinitely many elements. -/
def StatementOfTheorem : Prop :=
  Infinite GG5_At_Critical_radius
```

**Key Definitions**:

- **φ** (golden ratio, in `Core.lean`): `φ = (1 + √5)/2`
- **r_crit** (critical radius, in `Core.lean`): `r_crit = √(3 + φ)`
- **genA_n n r** (in `Geometry.lean`): N-fold generator rotating by -2π/n about (-1), identity outside left disk
- **genB_n n r** (in `Geometry.lean`): N-fold generator rotating by -2π/n about (+1), identity outside right disk
- **genA_n_bijective, genB_n_bijective** (in `GroupAction.lean`): Bijectivity proofs for N-fold generators
- **TwoDiskCompoundSymmetryGroup n hn r** (in `MainTheorem.lean`): Subgroup of `Equiv.Perm ℂ` generated by A_n and B_n
- **GG5_At_Critical_radius** (in `MainTheorem.lean`): `TwoDiskCompoundSymmetryGroup 5 (by norm_num) r_crit`

## Architecture

The formalization uses a group-theoretic approach:

- **Primary representation**: Complex numbers (ℂ) with standard topology
- **Generators**: Piecewise isometries (rotations inside disks, identity outside)
- **Group structure**: Formal subgroup of `Equiv.Perm ℂ` via `Subgroup.closure`
- **N-fold generalization**: GG(n,n) defined for any n ≥ 1, specialized to n=5
- **Rotation direction**: Clockwise (-2π/n), matching paper convention

## Kim Morrison Standard Compliance

This project follows the [Kim Morrison standard](https://leanprover.zulipchat.com/#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/Discussion.3A.20AI-written.20mathematical.proofs/with/558843568) for AI-assisted formal mathematics:

- **MainTheorem.lean** contains only definitions and the theorem statement (94 lines)
- **ProofOfMainTheorem.lean** provides the proof (122 lines)
- **Definitions/** contains all definitions and supporting lemmas (human-reviewable, 1298 lines)
- **Proofs/** contains only lemmas and theorems (machine-verified, 8412 lines)
- Uses only standard axioms

**Key architectural decision**: MainTheorem.lean contains only definitions (φ, r_crit, genA_n_perm, genB_n_perm, TwoDiskCompoundSymmetryGroup, GG5_At_Critical_radius, StatementOfTheorem). All proof machinery, including bijectivity proofs for the generators, lives in Definitions/GroupAction.lean. This makes MainTheorem.lean maximally readable while keeping the review burden low.

Run verification:

```bash
lake build && lake env lean --run KMVerify/Main.lean
```

## KMVerify Results

```
================================================================================
KIM MORRISON STANDARD VERIFICATION
Project: TDCSG
================================================================================

TRUST TIER SUMMARY
--------------------------------------------------------------------------------
  MathlibExtensions/          [NOT PRESENT]
  Definitions/                8 files     1298 lines
  Proofs/                     19 files    8412 lines
  MainTheorem.lean                        94 lines
  ProofOfMainTheorem.lean                 122 lines
--------------------------------------------------------------------------------
  REVIEW BURDEN: 1392 lines (Definitions + MainTheorem)
  TOTAL: 9926 lines (14% requires review)

CHECKS
--------------------------------------------------------------------------------
  [PASS] Structure
  [PASS] Axioms
  [PASS] Transparency
  [PASS] Completeness
  [PASS] Proof Minimality
  [PASS] No Duplicates
  [PASS] Imports
  [PASS] MainTheorem Purity
  [PASS] No Instances
  [PASS] No Trivial Definitions
  [PASS] Proofs Declarations

================================================================================
RESULT: PROJECT VERIFIED
================================================================================
```

## Project Structure

```text
TDCSG/
  MainTheorem.lean            # Core definitions + theorem statement (94 lines)
                              # Contains: genA_n_perm, genB_n_perm,
                              #           TwoDiskCompoundSymmetryGroup, GG5_At_Critical_radius,
                              #           StatementOfTheorem
                              # Imports φ, r_crit, genA_n, genB_n from Definitions/
  ProofOfMainTheorem.lean     # Complete proof of main theorem (122 lines)

  Definitions/                # All definitions (8 files, 1298 lines)
    Core.lean                 # φ, r_crit, Generator, Word, ζ₅ (zeta5), Circle defs
    Geometry.lean             # Disk geometry, rotations, genA_n, genB_n (N-fold generators)
    GroupAction.lean          # genA, genB (5-fold), applyGen, applyWord, orbit
                              # Bijectivity proofs: genA_n_bijective, genB_n_bijective
                              # Circle periodicity, order-n properties
    GroupTheory.lean          # 5-fold infrastructure (genA_perm, genB_perm)
                              # Group orbits, specialization lemmas
    IET.lean                  # Interval exchange transformations
    Points.lean               # Special points E, E', F, G, segmentPoint
    RealDynamics.lean         # Real dynamics, displacement functions
    WordCorrespondence.lean   # word1, word2, word3 for IET correspondence

  Proofs/                     # Supporting lemmas (19 files, 8412 lines)
    GroupTheory.lean          # Orbit-group correspondence, infinite orbit theorems
    IETOrbit.lean             # IET infinite orbit theorems
    OrbitInfinite.lean        # Main infinite orbit result
    Points.lean               # Point properties, scalar relations
    Geometry.lean             # Critical radius lemmas
    SegmentGeometry.lean      # Segment lengths and ratios
    Zeta5.lean                # ζ₅ identities and properties
    IET.lean                  # IET interval properties
    Orbit.lean                # General orbit theory
    AlgebraicIdentities.lean  # Algebraic manipulations
    RotationFormulas.lean     # Rotation computation lemmas
    Word1Correspondence.lean  # Word1 displacement correspondence
    Word2Correspondence.lean  # Word2 displacement correspondence
    Word3Correspondence.lean  # Word3 displacement correspondence
    CrossDiskBasic.lean       # Cross-disk trajectory analysis
    CrossDiskRestricted.lean  # Restricted cross-disk bounds
    CrossDiskWord2DiskBounds.lean  # Word2-specific bounds
    CrossDiskWord3DiskBounds.lean  # Word3-specific bounds
    CrossDiskWord3Helpers.lean     # Word3 helper lemmas

KMVerify/                     # Kim Morrison standard verification tool
  Main.lean                   # CLI entry point
  Config.lean                 # Configuration (updated to allow MainTheorem imports)
  FileUtils.lean              # File parsing (updated for Unicode identifiers)
  Checks/
    Duplicates.lean           # Duplicate check (updated to allow MainTheorem re-exports)
```

## Dependency Graph

An interactive visualization of all 767 TDCSG declarations and their dependencies:

```bash
./scripts/build_dep_graph.sh  # Generate graph
open docs/dep_graph.html      # View interactive version
open docs/deps_static.svg     # View static version (faster for large graphs)
```

**Features:**
- **Interactive**: Zoom (scroll), pan (drag), and search by declaration name
- **Loading indicator**: Shows progress for large graph rendering
- **Static fallback**: Pre-rendered SVG available if interactive version is slow
- **Color-coded**: Green shades indicate formalized declarations (all 767 are complete)
  - Light green: Definitions
  - Lawn green: CompoundSymmetry proofs
  - Pale green: Supporting proofs
- **Node shapes**: Ellipse (theorem/lemma), Box (definition), Diamond (inductive/structure)
- **Direct dependencies**: Edges show immediate "uses" relationships
- **Portable**: Also generates `docs/deps.dot` (Graphviz DOT format)

**Alternative renderers** (requires graphviz):
```bash
dot -Tpdf docs/deps.dot -o deps.pdf
```

## Proof Architecture

The proof establishes that GG5 is infinite via orbit analysis:

1. **Group Definition**: GG5 = Subgroup.closure {A, B} where A, B are 5-fold piecewise rotations
2. **IET Correspondence**: Group action induces interval exchange transformation on segment E'E
3. **Golden Ratio Structure**: IET has three intervals with lengths in ratio 1 : φ : φ²
4. **Linear Independence**: Since {1, φ} are linearly independent over ℤ, no periodic orbits exist
5. **Infinite Orbits**: Construct point x₀ with infinite IET orbit → infinite group orbit
6. **Conclusion**: Infinite group orbit implies infinite group (finite groups have finite orbits)

**Key Innovation**: The formalization generalizes to GG(n,n) for arbitrary n ≥ 1, with the 5-fold case as a specialization. This makes the mathematical structure clearer and enables potential future work on other critical radii.

## Build Commands

```bash
# Build entire project
lake build

# Build main theorem only
lake build TDCSG.ProofOfMainTheorem

# Run Kim Morrison verification
lake env lean --run KMVerify/Main.lean

# JSON output for CI
lake env lean --run KMVerify/Main.lean --json

# Check for sorries in specific file
./check_lean.sh --sorries TDCSG/Definitions/GroupTheory.lean

# Check all Definitions for sorries
./check_lean.sh --all sorries TDCSG/Definitions/
```

## Mathematical Background

The two-disk compound symmetry group GG(n,n) at radius r consists of all bijections of ℂ generated by:

- **A_n**: rotation by -2π/n about (-1) inside the left disk of radius r, identity outside
- **B_n**: rotation by -2π/n about (+1) inside the right disk of radius r, identity outside

These generators satisfy A_n^n = B_n^n = id (order-n elements).

**The central question**: For which (n, r) is GG(n,n) finite vs infinite?

**This formalization proves**: GG(5,5) is infinite at r_crit = √(3 + φ) where φ = (1+√5)/2.

The critical radius r_crit is special because the two disks intersect in a way that creates a fundamental domain whose boundary admits an interval exchange transformation with rotation number related to the golden ratio, precluding periodic orbits.

## References

- **Paper**: [Two-Disk Compound Symmetry Groups (arXiv:2302.12950v1)](https://arxiv.org/abs/2302.12950)
- **Authors**: Eric Hearn, Justin Kretschmer, Tom Rokicki, Gabriel Streeter, Eva Vergo
- **Kim Morrison Standard**: [Zulip discussion](https://leanprover.zulipchat.com/#narrow/channel/219941-Machine-Learning-for-Theorem-Proving/topic/Discussion.3A.20AI-written.20mathematical.proofs/with/558843568)

## License

Apache 2.0 - See LICENSE file
